define(["exports","./haxcms-site-store.js","../../../../mobx/lib/mobx.module.js","../../../utils/utils.js","../../../simple-colors-shared-styles/simple-colors-shared-styles.js","../../../anchor-behaviors/anchor-behaviors.js"],(function(_exports,_haxcmsSiteStore,_mobxModule,_utils,_simpleColorsSharedStyles,_anchorBehaviors){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.HAXCMSThemeWiring=_exports.HAXCMSTheme=void 0;_exports.HAXCMSTheme=function(SuperClass){return class extends SuperClass{constructor(){super(),this.HAXCMSThemeSettings={autoScroll:!1},this.__disposer=[],this.HAXCMSThemeWiring=new HAXCMSThemeWiring(this)}_colorChanged(newValue){newValue&&(this.hexColor=this._getHexColor(newValue))}_getHexColor(color){let name=color.replace("-text",""),colors=window.SimpleColorsStyles.colors;return colors[name]?colors[name][6]:"#000000"}_editModeChanged(newValue,oldValue){void 0!==oldValue&&(_haxcmsSiteStore.store.editMode=newValue,this.__styleReapply())}_contentContainerChanged(newValue,oldValue){!newValue||void 0!==oldValue&&null!=oldValue?newValue&&oldValue?(this.HAXCMSThemeWiring.disconnect(this),this.HAXCMSThemeWiring.connect(this,newValue)):oldValue&&null==newValue&&this.HAXCMSThemeWiring.disconnect(this):this.HAXCMSThemeWiring.connect(this,newValue)}_locationChanged(newValue,oldValue){if(!newValue||void 0===newValue.route)return;const name=newValue.route.name;if("home"==name||"404"==name){const firstItem=_haxcmsSiteStore.store.routerManifest.items.find(i=>void 0!==i.id);firstItem&&(_haxcmsSiteStore.store.activeId=firstItem.id)}this.HAXCMSThemeSettings.autoScroll&&(window.scrollTo({top:0,left:0}),setTimeout(()=>{window.AnchorBehaviors.getTarget(_haxcmsSiteStore.store.themeElement)},1e3))}connectedCallback(){super.connectedCallback(),setTimeout(()=>{if(0===this.childNodes.length){let frag=document.createRange().createContextualFragment(_haxcmsSiteStore.store.activeItemContent);this.appendChild(frag)}this.__styleReapply()},50),(0,_mobxModule.autorun)(reaction=>{this.editMode=(0,_mobxModule.toJS)(_haxcmsSiteStore.store.editMode),this.__disposer.push(reaction)}),(0,_mobxModule.autorun)(reaction=>{this.isLoggedIn=(0,_mobxModule.toJS)(_haxcmsSiteStore.store.isLoggedIn),this.__disposer.push(reaction)}),(0,_mobxModule.autorun)(reaction=>{const __manifest=(0,_mobxModule.toJS)(_haxcmsSiteStore.store.manifest);if(__manifest&&(0,_utils.varExists)(__manifest,"title")&&(document.title=__manifest.title),__manifest&&(0,_utils.varExists)(__manifest,"metadata.theme.variables.cssVariable")){let ary=__manifest.metadata.theme.variables.cssVariable.replace("--simple-colors-default-theme-","").split("-");ary.pop(),this.accentColor=ary.join("-");var color=(0,_utils.varGet)(__manifest,"metadata.theme.variables.cssVariable",null);color=null==color?(0,_utils.varGet)(__manifest,"metadata.theme.variables.hexCode","#ff0074"):`var(${color})`,document.body.style.setProperty("--haxcms-color",color)}this.__disposer.push(reaction)}),(0,_mobxModule.autorun)(reaction=>{this._location=(0,_mobxModule.toJS)(_haxcmsSiteStore.store.location),this.__disposer.push(reaction)})}__styleReapply(){window.dispatchEvent(new Event("resize"))}disconnectedCallback(){for(var i in delete this.contentContainer,this.__disposer)this.__disposer[i].dispose();super.disconnectedCallback()}resetActive(){window.history.pushState(null,null,_haxcmsSiteStore.store.location.baseUrl),window.dispatchEvent(new PopStateEvent("popstate")),this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,composed:!0,cancelable:!0,detail:{}}))}}};class HAXCMSThemeWiring{constructor(element,load=!0){window.SimpleColorsSharedStyles.requestAvailability(),load&&null==window.localStorage.getItem("HAXCMSSystemData")&&window.localStorage.setItem("HAXCMSSystemData",JSON.stringify({}))}connect(element,injector){window.addEventListener("haxcms-active-item-changed",this._activeItemUpdate.bind(element)),window.addEventListener("haxcms-edit-mode-changed",this._globalEditChanged.bind(element)),window.addEventListener("haxcms-trigger-update",this._triggerUpdate.bind(element)),_haxcmsSiteStore.store.cmsSiteEditorAvailability(),_haxcmsSiteStore.store.cmsSiteEditor.instance.appElement=element,_haxcmsSiteStore.store.cmsSiteEditor.instance.appendTarget=injector,_haxcmsSiteStore.store.cmsSiteEditor.instance.appendTarget.appendChild(_haxcmsSiteStore.store.cmsSiteEditor.instance)}disconnect(element){window.removeEventListener("haxcms-active-item-changed",this._activeItemUpdate.bind(element)),window.removeEventListener("haxcms-edit-mode-changed",this._globalEditChanged.bind(element)),window.removeEventListener("haxcms-trigger-update",this._triggerUpdate.bind(element)),document.body.appendChild(_haxcmsSiteStore.store.cmsSiteEditorAvailability())}_globalEditChanged(e){this.editMode=e.detail}_activeItemUpdate(e){let newValue=e.detail;if(newValue&&void 0!==newValue.id){_haxcmsSiteStore.store.activeId=newValue.id;const evt=new CustomEvent("json-outline-schema-active-item-changed",{bubbles:!0,composed:!0,cancelable:!0,detail:newValue});this.dispatchEvent(evt),void 0!==newValue.title?document.title=_haxcmsSiteStore.store.routerManifest.title+" - "+newValue.title:document.title=_haxcmsSiteStore.store.routerManifest.title}else document.title=_haxcmsSiteStore.store.routerManifest.title}_triggerUpdate(e){this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,composed:!0,cancelable:!0,detail:{}}))}}_exports.HAXCMSThemeWiring=HAXCMSThemeWiring}));