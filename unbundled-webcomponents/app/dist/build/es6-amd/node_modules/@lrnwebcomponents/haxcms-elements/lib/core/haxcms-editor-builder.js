define(["exports","meta","require","./haxcms-site-store.js"],(function(_exports,meta,_require,_haxcmsSiteStore){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.HAXCMSEditorBuilder=void 0,meta=babelHelpers.interopRequireWildcard(meta),_require=babelHelpers.interopRequireWildcard(_require);
/**
   * Copyright 2018 The Pennsylvania State University
   * @license Apache-2.0, see License.md for full text.
   */
class HAXCMSEditorBuilder extends HTMLElement{static get tag(){return"haxcms-editor-builder"}constructor(){super(),this.applyContext(),window.addEventListener("haxcms-site-editor-loaded",this.editorLoaded.bind(this))}connectedCallback(){super.connectedCallback&&super.connectedCallback(),this.dispatchEvent(new CustomEvent("haxcms-editor-builder-ready",{bubbles:!0,composed:!0,cancelable:!1,detail:this}))}disconnectedCallback(){window.removeEventListener("haxcms-site-editor-loaded",this.editorLoaded.bind(this)),super.disconnectedCallback&&super.disconnectedCallback()}getContext(){let context="";return context="undefined"!=typeof DatArchive?"beaker":!0===window.__haxCMSContextPublished?"published":!0===window.__haxCMSContextNode?"nodejs":!0===window.__haxCMSContextDemo?"demo":"php",context}editorLoaded(e){_haxcmsSiteStore.store.cmsSiteEditor.haxCmsSiteEditorUIElement||(new Promise((res,rej)=>_require.default(["./haxcms-site-editor-ui.js"],res,rej)),_haxcmsSiteStore.store.cmsSiteEditor.haxCmsSiteEditorUIElement=document.createElement("haxcms-site-editor-ui"),document.body.appendChild(_haxcmsSiteStore.store.cmsSiteEditor.haxCmsSiteEditorUIElement),setTimeout(()=>{_haxcmsSiteStore.store.cmsSiteEditor.haxCmsSiteEditorUIElement.painting=!1},5))}pathFromUrl(url){return url.substring(0,url.lastIndexOf("/")+1)}applyContext(context=null){if(!this.__appliedContext){if(this.__appliedContext=!0,null==context&&(context=this.getContext()),"php"===context||"nodejs"===context){let script=document.createElement("script");window.appSettings&&window.appSettings.connectionSettings?script.src=window.appSettings.connectionSettings:script.src="../../system/api/connectionSettings",fetch(script.src).then(response=>{404!=response.status&&document.documentElement.appendChild(script)})}if("published"!==context){const basePath=this.pathFromUrl(decodeURIComponent(meta.url));_haxcmsSiteStore.store.cmsSiteEditorBackend.tag="haxcms-backend-"+context,new Promise((res,rej)=>_require.default([`${basePath}backends/${_haxcmsSiteStore.store.cmsSiteEditorBackend.tag}.js`],res,rej)).then(e=>{_haxcmsSiteStore.store.cmsSiteEditorBackend.instance||(_haxcmsSiteStore.store.cmsSiteEditorBackend.instance=document.createElement(_haxcmsSiteStore.store.cmsSiteEditorBackend.tag),document.body.append(_haxcmsSiteStore.store.cmsSiteEditorBackend.instance))})}}}}_exports.HAXCMSEditorBuilder=HAXCMSEditorBuilder,window.customElements.define(HAXCMSEditorBuilder.tag,HAXCMSEditorBuilder)}));