/**
 * Copyright 2019 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{LitElement,html,css}from"../../../../../lit-element/lit-element.js";import"../../../../simple-fields/lib/simple-fields-field.js";import"../../../../../@polymer/iron-icons/iron-icons.js";import"../../../../../@polymer/iron-icon/iron-icon.js";class SiteSearch extends LitElement{static get styles(){return[css`
        :host {
          display: block;
          font-size: 16px;
          color: var(--site-search-color, #383f45);
          height: 55vh;
          width: 60vh;
        }
        .result {
          display: block;
          background-color: #eeeeee;
          color: #222222;
          border: 1px solid black;
          padding: 16px;
        }
        .result:hover,
        .result:focus {
          background-color: #dddddd;
          color: black;
          color: var(--site-search-link-color-hover, #000000);
          text-decoration: underline;
        }
        .result .title {
          font-size: 28px;
          margin: 0 0 8px 0;
          line-height: 1;
        }
        .result {
          color: var(--site-search-link-color, #444444);
          text-decoration: none;
        }
        .result .link-text {
          font-size: 12px;
          color: var(--site-search-link-text-color, #999999);
          font-style: italic;
          padding-left: 8px;
        }
        #search {
          flex-grow: 2;
          margin-right: 4px;
          --simple-fields-accent-color: var(--site-search-text-color, #000);
          color: var(--site-search-placeholder-color, #222);
        }
      `]}static get tag(){return"site-search"}constructor(){super(),this.search="",this.__results=[],setTimeout(()=>{import("../../../../lunr-search/lunr-search.js"),import("../../../../simple-datetime/simple-datetime.js")},0)}render(){return html`
      <simple-fields-field
        id="search"
        always-float-label
        label="Search"
        type="text"
        @value-changed="${this._searchValueChanged}"
      >
        <iron-icon icon="search" slot="prefix"></iron-icon>
      </simple-fields-field>
      ${this.search.length>0?html`
            Found ${this.__results.length} results.
          `:html``}
      <lunr-search id="lunr"></lunr-search>

      ${this.__results.map(item=>html`
          <a class="result" .href="${item.location}">
            <div class="title">
              ${item.title}<span class="link-text" aria-hidden="true"
                >(${item.location})</span
              >
            </div>
            <div class="date">
              <simple-datetime format="M jS" .timestamp="${item.created}" unix
                >${item.created}</simple-datetime
              >
            </div>
            <p>${item.description}..</p>
          </a>
        `)}
    `}_searchValueChanged(e){this.search=e.detail.value}__resultsChanged(e){e.detail.value?this.__results=[...e.detail.value]:this.__results=[]}static get properties(){return{dataSource:{type:String,attribute:"data-source"},search:{type:String},__results:{type:Array}}}firstUpdated(changedProperties){this.shadowRoot.querySelector("#lunr").addEventListener("results-changed",this.__resultsChanged.bind(this))}updated(changedProperties){changedProperties.forEach((oldValue,propName)=>{"search"==propName&&(this._searchChanged(this[propName],oldValue),this.shadowRoot.querySelector("#lunr").search=this[propName]),"dataSource"==propName&&this[propName]&&(this.shadowRoot.querySelector("#lunr").dataSource=this[propName])})}_searchChanged(term,oldTerm){term.length>=3&&void 0===this.dataSource&&(this.dataSource="lunrSearchIndex.json")}}window.customElements.define(SiteSearch.tag,SiteSearch);export{SiteSearch};